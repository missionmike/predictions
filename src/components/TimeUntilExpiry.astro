---
interface Props {
  pubDate: Date;
  expiryDate: Date;
}

const { pubDate, expiryDate } = Astro.props;

const now = new Date();
const diffTime = expiryDate.getTime() - now.getTime();
const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

let timeUntilText = '';
if (diffDays < 0) {
  timeUntilText = 'Expired';
} else if (diffDays === 0) {
  timeUntilText = 'Today';
} else if (diffDays === 1) {
  timeUntilText = 'Tomorrow';
} else {
  const diffYears = Math.ceil(diffDays / 365);
  const diffMonths = Math.ceil(diffDays / 30);
  const diffWeeks = Math.ceil(diffDays / 7);

  if (diffYears >= 1) {
    timeUntilText = `${diffYears} ${diffYears === 1 ? 'year' : 'years'}`;
  } else if (diffMonths >= 1) {
    timeUntilText = `${diffMonths} ${diffMonths === 1 ? 'month' : 'months'}`;
  } else if (diffWeeks >= 1) {
    timeUntilText = `${diffWeeks} ${diffWeeks === 1 ? 'week' : 'weeks'}`;
  } else {
    timeUntilText = `${diffDays} days`;
  }
}
---

<time datetime={pubDate.toISOString()}>
  {timeUntilText}
</time>
